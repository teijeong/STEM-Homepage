 {% extends "memberapp/base.html" %}
 {% block content %}
 <section class="content-header">
  <h1>
    마일스톤
    <small>큰 프로젝트 단위의 업무입니다</small>
  </h1>
  <ol class="breadcrumb">
    <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
    <li class="active">Milestone</li>
  </ol>
  <div class="add-task"><i class="fa fa-plus command-elem" onclick="showModal()"></i></div>
</section>

<!-- Main content -->
<section class="content">
    <div class="row">
        {% for milestone in milestones %}
        <div class="col-md-3 col-sm-4 col-xs-12">
            <a href="/stem/milestone/{{milestone.id}}">
				{% if milestone.priority == 0 %}
                <div class="info-box bg-red">
				{% else %}
                <div class="info-box bg-green">
				{% endif %}
                    <span class="info-box-icon"><i class="fa fa-wrench"></i></span>
                    <div class="info-box-content">
                      <span class="info-box-number">M#{{milestone.local_id}}</span>
                      <span class="info-box-text">{{milestone.name}}</span>
                      <div class="progress">
                        <div class="progress-bar" style="width: {{milestone.progress}}%"></div>
                      </div>
                      <span class="progress-description">
                        {{milestone.progress}}% 완료
                      </span>
                    </div><!-- /.info-box-content -->
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
</section><!-- /.content -->
{% endblock %}

{% block modals %}
<div class="modal-dialog" id="add-milestone" style="display:none">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h4 class="modal-title">새 마일스톤</h4>
      </div>
      <div class="modal-body">
        <form role="form">
            <div class="form-group">
              <label for="milestone-name">마일스톤 이름</label>
              <input class="form-control" id="milestone-name" type="text">
            </div>
            <div class="form-group">
              <label for="milestone-description">설명</label>
              <textarea id="milestone-description"></textarea>
            </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default pull-left" data-dismiss="modal" onclick="closeModal()">취소</button>
        <button type="button" class="btn btn-primary" onclick="addMilestone()">추가</button>
      </div>
    </div><!-- /.modal-content -->
</div>
{% endblock %}

{% block styles %}
    <link href="{{url_for('static', filename='adminLTE/plugins/datatables/dataTables.bootstrap.css')}}" rel="stylesheet" type="text/css">
{% endblock %}

{% block scripts %}
    <script src="{{url_for('static', filename='adminLTE/plugins/datatables/jquery.dataTables.min.js')}}" type="text/javascript"></script>
    <script src="{{url_for('static', filename='adminLTE/plugins/datatables/dataTables.bootstrap.min.js')}}" type="text/javascript"></script>
    <script src="{{url_for('static', filename='js/jquery.easyModal.js')}}"></script>
    <script src="https://cdn.ckeditor.com/4.4.3/standard/ckeditor.js" type="text/javascript"></script>

<script type="text/javascript">

$("#add-milestone").easyModal();
$(".modal-dialog").css("display","default");

var editor = CKEDITOR.replace('milestone-description',
    {toolbarGroups:[
        { name: 'clipboard',   groups: ['undo' ] },
        { name: 'links' },
        { name: 'insert' },
        { name: 'forms' },
        { name: 'tools' },
        { name: 'others' },
        '/',
        { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },
        { name: 'paragraph',   groups: [ 'list', 'indent', 'blocks', 'align' ] },
        { name: 'styles' },
        { name: 'colors' }]
    });



function showModal() {
    $("#add-milestone").trigger("openModal");
}

function closeModal() {
    $("#add-milestone").trigger("closeModal");
}

function addMilestone() {
    var name = $("#milestone-name").val().trim();
    var description = editor.getData();
    if (name === "") return;

    $.ajax({
        url: "/stem/api/task",
        type: "POST",
        data: {
            name: name,
            description: description,
            level: 0
        },
        success: function(data) {
            location.reload();
        }
    });
}
</script>
{% endblock %}
